!   docletHub.ecs

    script DocletHub

    use mqtt
    use plugin Doclets from ec_doclets

    topic RequestTopic
    topic ResponseTopic
    dictionary Doclet
    dictionary Message
    dictionary Payload
    dictionary ReplyTo
    list List
    list Senders
    list Topics
    variable Query
    variable DocletPath
    variable Name
    variable Text
    variable FilePath
    variable Sender
    variable Topic
    variable Action
    variable ResponseName
    variable ReplyToName
    variable ReplyToQoS
    variable MessageText
    variable N
    variable P
    variable S
    
    debug step

    init RequestTopic
        name `a8:41:f4:d3:19:dd/request`
        qos 1

    mqtt
        id uuid
        broker `test.mosquitto.org`
        port 1883
        topics RequestTopic

    doclets init
    
    on mqtt message
    begin
        put the mqtt message into Message
        put entry `topic` of Message into Topic
        put entry `payload` of Message into Payload

        put entry `reply-to` of Payload into ReplyTo
        put entry `action` of Payload into Action

        put entry `name` of ReplyTo into ReplyToName
        put entry `qos` of ReplyTo into ReplyToQoS
        put entry `message` of Message into MessageText
        log `Sender: ` cat ReplyToName
        log `QoS:` cat ReplyToQoS
        log `Message: ` cat MessageText
        log `Action: ` cat Action

        if Action is `topics` go to GetTopics

    stop

! Get a list of the available doclet topics
GetTopics:
    put the doclet topics into Topics
    log Topics
    stop