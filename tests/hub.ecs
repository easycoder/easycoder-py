!   hub.ecs

    script MQTTHub

    use mqtt
    use plugin Doclets from ec_doclets

    topic Request
    topic Response
    dictionary Doclet
    list List
    variable Query
    variable Name
    variable Text
    variable FilePath
    variable N
    variable P
    
!    debug step

    init Request
        name `a8:41:f4:d3:19:dd/request`
        qos 1
    init Response
        name `a8:41:f4:d3:19:dd/response`
        qos 1

    mqtt
        id `EasyCoder-MQTT-Hub`
        broker `test.mosquitto.org`
        port 1883
        topics Request

    doclets init
        path `~/Doclets/Linux,~/Doclets/Doclets,~/Doclets/EasyCoder,~/Doclets/RBR`
    
    on mqtt message
    begin
        put the mqtt message into Query
        log `Query: ` cat the mqtt topic cat ` - ` cat Query
        put the position of `:` in Query into P
        if left P of Query is `file`
        begin
            increment P
            put from P of Query into Name
            load Text from Name
            send mqtt Text to Response
        end
        else
        begin
            get List from doclet query Query
            if the count of List is 0 log `No results`
            else begin
                log `Results: ` cat List
            end
            send mqtt List to Response
        end
    end

    stop
